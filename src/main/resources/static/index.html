<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Estudiantes y Cursos - Relaci贸n Muchos a Muchos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .section h2 {
            color: #667eea;
            margin-bottom: 15px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            margin-top: 10px;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #5568d3;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-success {
            background: #27ae60;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .list-section {
            grid-column: 1 / -1;
        }
        
        .list-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-left: 4px solid #667eea;
        }
        
        .list-item h3 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .list-item p {
            color: #666;
            margin-bottom: 5px;
        }
        
        .badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 12px;
            margin-right: 5px;
        }
        
        .relationship-section {
            grid-column: 1 / -1;
            margin-top: 20px;
        }
        
        .relationship-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .message {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1> Sistema de Gesti贸n: Estudiantes y Cursos</h1>
        
        <div id="message" class="message"></div>
        
        <div class="sections">
            <!-- Secci贸n de Estudiantes -->
            <div class="section">
                <h2> Gesti贸n de Estudiantes</h2>
                <div class="form-group">
                    <label>Nombre:</label>
                    <input type="text" id="studentName" placeholder="Ej: Juan P茅rez">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="studentEmail" placeholder="Ej: juan@example.com">
                </div>
                <button class="btn" onclick="createStudent()">Crear Estudiante</button>
                <button class="btn btn-success" onclick="loadStudents()">Cargar Estudiantes</button>
            </div>
            
            <!-- Secci贸n de Cursos -->
            <div class="section">
                <h2> Gesti贸n de Cursos</h2>
                <div class="form-group">
                    <label>Nombre del Curso:</label>
                    <input type="text" id="courseName" placeholder="Ej: Matem谩ticas">
                </div>
                <div class="form-group">
                    <label>C贸digo:</label>
                    <input type="text" id="courseCode" placeholder="Ej: MAT101">
                </div>
                <div class="form-group">
                    <label>Cr茅ditos:</label>
                    <input type="number" id="courseCredits" placeholder="Ej: 3" min="1">
                </div>
                <button class="btn" onclick="createCourse()">Crear Curso</button>
                <button class="btn btn-success" onclick="loadCourses()">Cargar Cursos</button>
            </div>
            
            <!-- Relaci贸n Muchos a Muchos -->
            <div class="section relationship-section">
                <h2> Asignar Cursos a Estudiantes</h2>
                <div class="relationship-controls">
                    <div class="form-group">
                        <label>Estudiante:</label>
                        <select id="studentSelect"></select>
                    </div>
                    <div class="form-group">
                        <label>Curso:</label>
                        <select id="courseSelect"></select>
                    </div>
                </div>
                <button class="btn" onclick="assignCourse()">Asignar Curso</button>
                <button class="btn btn-danger" onclick="removeCourse()">Quitar Curso</button>
            </div>
            
            <!-- Lista de Estudiantes -->
            <div class="section list-section">
                <h2> Lista de Estudiantes</h2>
                <div id="studentsList"></div>
            </div>
            
            <!-- Lista de Cursos -->
            <div class="section list-section">
                <h2> Lista de Cursos</h2>
                <div id="coursesList"></div>
            </div>
        </div>
    </div>
    
    <script>
        const API_URL = 'http://localhost:8080/api';
        
        // Funciones de utilidad
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }
        
        // CRUD Estudiantes
        async function createStudent() {
            const name = document.getElementById('studentName').value;
            const email = document.getElementById('studentEmail').value;
            
            if (!name || !email) {
                showMessage('Por favor completa todos los campos', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/students`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email })
                });
                
                if (response.ok) {
                    showMessage('Estudiante creado exitosamente', 'success');
                    document.getElementById('studentName').value = '';
                    document.getElementById('studentEmail').value = '';
                    loadStudents();
                } else {
                    showMessage('Error al crear estudiante', 'error');
                }
            } catch (error) {
                showMessage('Error de conexi贸n', 'error');
            }
        }
        
        async function loadStudents() {
            try {
                const response = await fetch(`${API_URL}/students`);
                const students = await response.json();
                
                const listDiv = document.getElementById('studentsList');
                const select = document.getElementById('studentSelect');
                
                listDiv.innerHTML = '';
                select.innerHTML = '<option value="">Seleccione un estudiante</option>';
                
                students.forEach(student => {
                    // Lista
                    const item = document.createElement('div');
                    item.className = 'list-item';
                    item.innerHTML = `
                        <h3>${student.name}</h3>
                        <p><strong>Email:</strong> ${student.email}</p>
                        <p><strong>ID:</strong> ${student.id}</p>
                        <button class="btn btn-danger" onclick="deleteStudent(${student.id})">Eliminar</button>
                        <button class="btn" onclick="viewStudentCourses(${student.id})">Ver Cursos</button>
                    `;
                    listDiv.appendChild(item);
                    
                    // Select
                    const option = document.createElement('option');
                    option.value = student.id;
                    option.textContent = student.name;
                    select.appendChild(option);
                });
            } catch (error) {
                showMessage('Error al cargar estudiantes', 'error');
            }
        }
        
        async function deleteStudent(id) {
            if (!confirm('驴Est谩s seguro de eliminar este estudiante?')) return;
            
            try {
                const response = await fetch(`${API_URL}/students/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showMessage('Estudiante eliminado', 'success');
                    loadStudents();
                }
            } catch (error) {
                showMessage('Error al eliminar', 'error');
            }
        }
        
        async function viewStudentCourses(id) {
            try {
                const response = await fetch(`${API_URL}/students/${id}`);
                const student = await response.json();
                
                if (student.courses && student.courses.length > 0) {
                    const courses = student.courses.map(c => c.name).join(', ');
                    alert(`Cursos de ${student.name}:\n${courses}`);
                } else {
                    alert(`${student.name} no tiene cursos asignados`);
                }
            } catch (error) {
                showMessage('Error al cargar cursos del estudiante', 'error');
            }
        }
        
        // CRUD Cursos
        async function createCourse() {
            const name = document.getElementById('courseName').value;
            const code = document.getElementById('courseCode').value;
            const credits = parseInt(document.getElementById('courseCredits').value);
            
            if (!name || !code || !credits) {
                showMessage('Por favor completa todos los campos', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/courses`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, code, credits })
                });
                
                if (response.ok) {
                    showMessage('Curso creado exitosamente', 'success');
                    document.getElementById('courseName').value = '';
                    document.getElementById('courseCode').value = '';
                    document.getElementById('courseCredits').value = '';
                    loadCourses();
                } else {
                    showMessage('Error al crear curso', 'error');
                }
            } catch (error) {
                showMessage('Error de conexi贸n', 'error');
            }
        }
        
        async function loadCourses() {
            try {
                const response = await fetch(`${API_URL}/courses`);
                const courses = await response.json();
                
                const listDiv = document.getElementById('coursesList');
                const select = document.getElementById('courseSelect');
                
                listDiv.innerHTML = '';
                select.innerHTML = '<option value="">Seleccione un curso</option>';
                
                courses.forEach(course => {
                    // Lista
                    const item = document.createElement('div');
                    item.className = 'list-item';
                    item.innerHTML = `
                        <h3>${course.name} (${course.code})</h3>
                        <p><strong>Cr茅ditos:</strong> ${course.credits}</p>
                        <p><strong>ID:</strong> ${course.id}</p>
                        <button class="btn btn-danger" onclick="deleteCourse(${course.id})">Eliminar</button>
                    `;
                    listDiv.appendChild(item);
                    
                    // Select
                    const option = document.createElement('option');
                    option.value = course.id;
                    option.textContent = `${course.name} (${course.code})`;
                    select.appendChild(option);
                });
            } catch (error) {
                showMessage('Error al cargar cursos', 'error');
            }
        }
        
        async function deleteCourse(id) {
            if (!confirm('驴Est谩s seguro de eliminar este curso?')) return;
            
            try {
                const response = await fetch(`${API_URL}/courses/${id}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showMessage('Curso eliminado', 'success');
                    loadCourses();
                }
            } catch (error) {
                showMessage('Error al eliminar', 'error');
            }
        }
        
        // Relaci贸n Muchos a Muchos
        async function assignCourse() {
            const studentId = document.getElementById('studentSelect').value;
            const courseId = document.getElementById('courseSelect').value;
            
            if (!studentId || !courseId) {
                showMessage('Por favor selecciona un estudiante y un curso', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/students/${studentId}/courses/${courseId}`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    showMessage('Curso asignado exitosamente', 'success');
                    loadStudents();
                } else {
                    showMessage('Error al asignar curso', 'error');
                }
            } catch (error) {
                showMessage('Error de conexi贸n', 'error');
            }
        }
        
        async function removeCourse() {
            const studentId = document.getElementById('studentSelect').value;
            const courseId = document.getElementById('courseSelect').value;
            
            if (!studentId || !courseId) {
                showMessage('Por favor selecciona un estudiante y un curso', 'error');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/students/${studentId}/courses/${courseId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    showMessage('Curso removido exitosamente', 'success');
                    loadStudents();
                } else {
                    showMessage('Error al remover curso', 'error');
                }
            } catch (error) {
                showMessage('Error de conexi贸n', 'error');
            }
        }
        
        // Cargar datos al iniciar
        window.onload = function() {
            loadStudents();
            loadCourses();
        };
    </script>
</body>
</html>

